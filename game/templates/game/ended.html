{% extends 'game/includes/base.html' %}
{% load role_extras %}
{% block head_title %}ê²Œì„ ì¢…ë£Œ{% endblock %}
{% block page_title %}ê²Œì„ ì¢…ë£Œ{% endblock %}

{% block content %}
    <div class="ended-container">
        <!-- ê²Œì„ ì •ë³´ ì¹´ë“œ -->
        <div class="game-info-card">
            <div class="info-header">
                <div class="info-icon">ğŸ°</div>
                <h3 class="info-title">ê²Œì„ ì •ë³´</h3>
            </div>
            
            <div class="info-content">
                <div class="info-item">
                    <span class="info-label">ì„¸ì…˜ ID</span>
                    <span class="info-value session-id">{{ game_session.session_id }}</span>
                </div>
                

                
                <div class="info-item">
                    <span class="info-label">í˜„ì¬ í”Œë ˆì´ì–´</span>
                    <span class="info-value player-name">{{ player_nickname|default:"ì•Œ ìˆ˜ ì—†ìŒ" }}</span>
                </div>
                
                {% if player_nickname %}
                <div class="info-item">
                    <span class="info-label">ë‚˜ì˜ ì—­í• </span>
                    <div class="my-role-info">
                        {% for player_obj in players_in_session %}
                            {% if player_obj.nickname == player_nickname %}
                                {% if player_obj.roles and player_obj.roles|length > 1 %}
                                    <!-- ë‹¤ì¤‘ ì—­í•  -->
                                    {% for role in player_obj.roles %}
                                        <span class="role-badge role-{{ role }}">{{ role|role_display }}</span>
                                    {% endfor %}
                                {% else %}
                                    <!-- ë‹¨ì¼ ì—­í•  -->
                                    <span class="role-badge role-{{ player_obj.primary_role }}">{{ player_obj.primary_role|role_display }}</span>
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- ê²Œì„ ì¢…ë£Œ ë©”ì‹œì§€ ì¹´ë“œ -->
        <div class="game-end-message-card">
            <div class="end-message-header">
                <div class="end-message-icon">ğŸ­</div>
                <h3 class="end-message-title">ê²Œì„ ê²°ê³¼</h3>
            </div>
            
            <div class="end-message-content">
                <p class="end-message-text">{{ message }}</p>
            </div>
        </div>

        <!-- ì—­í•  ê³µê°œ ì¹´ë“œ -->
        {% if game_session.is_started %}
        <div class="roles-reveal-card">
            <div class="roles-header">
                <div class="roles-icon">ğŸª</div>
                <h3 class="roles-title">ì—­í•  ê³µê°œ</h3>
                <div class="roles-count">{{ players_in_session|length }}ëª…</div>
            </div>
            
            <div class="roles-content">
                <div class="roles-grid">
                    {% for player in players_in_session %}
                    <div class="role-reveal-item {% if player.faction == 'evil' %}evil-side{% else %}good-side{% endif %}">
                        <div class="player-role-avatar">
                            {% if player.role_images and player.role_images|length > 1 %}
                                <!-- ë‹¤ì¤‘ ì—­í•  ì´ë¯¸ì§€ -->
                                <div class="multi-role-images">
                                    {% for image in player.role_images %}
                                        <img src="{{ image }}" alt="ì—­í•  {{ forloop.counter }}" class="role-reveal-image-small">
                                    {% endfor %}
                                </div>
                            {% else %}
                                <!-- ë‹¨ì¼ ì—­í•  ì´ë¯¸ì§€ -->
                                <img src="{% if player.role_images.0 %}{{ player.role_images.0 }}{% else %}/static/default_role.png{% endif %}" alt="{{ player.primary_role }}" class="role-reveal-image">
                            {% endif %}
                        </div>
                        
                        <div class="player-role-info">
                            <div class="player-role-nickname">{{ player.nickname }}</div>
                            <div class="player-role-name">
                                {% if player.roles and player.roles|length > 1 %}
                                    <!-- ë‹¤ì¤‘ ì—­í•  -->
                                    <div class="multi-roles">
                                        {% for role in player.roles %}
                                            <span class="role-badge role-{{ role }}">{{ role|role_display }}</span>
                                        {% endfor %}
                                    </div>
                                {% else %}
                                    <!-- ë‹¨ì¼ ì—­í•  -->
                                    <span class="role-badge role-{{ player.primary_role }}">{{ player.primary_role|role_display }}</span>
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if player.nickname == game_session.host_nickname %}
                            <div class="player-host-badge-small">ğŸ‘‘</div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- ìƒˆ ê²Œì„ ì¶”ì²œ ì¹´ë“œ -->
        <div class="new-game-card">
            <div class="new-game-content">
                <div class="new-game-icon">ğŸ®</div>
                <h3 class="new-game-title">ìƒˆë¡œìš´ ê²Œì„ì„ ì‹œì‘í•´ë³´ì„¸ìš”!</h3>
                <p class="new-game-description">ë‹¤ì‹œ í•œ ë²ˆ ì•„ë°œë¡ ì˜ ì„¸ê³„ë¡œ ë– ë‚˜ë³´ì‹œê² ì–´ìš”?</p>
                <a href="{% url 'home' %}" class="new-game-btn">
                    <span class="btn-icon">ğŸš€</span>
                    <span class="btn-text">ìƒˆ ê²Œì„ ë§Œë“¤ê¸°</span>
                </a>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}