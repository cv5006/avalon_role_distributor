{% extends 'game/includes/base.html' %}
{% block head_title %}ê²Œì„ ë¡œë¹„{% endblock %}
{% block page_title %}ê²Œì„ ë¡œë¹„{% endblock %}

{% block content %} 
    <div class="lobby-container">
        <!-- ê²Œì„ ì •ë³´ ì¹´ë“œ -->
        <div class="game-info-card">
            <div class="info-header">
                <div class="info-icon">ğŸ°</div>
                <h3 class="info-title">ê²Œì„ ì •ë³´</h3>
            </div>
            
            <div class="info-content">
                <div class="info-item">
                    <span class="info-label">ì„¸ì…˜ ID</span>
                    <span class="info-value session-id">{{ game_session.session_id }}</span>
                </div>
                
                <div class="info-item">
                    <span class="info-label">ê²Œì„ ì˜µì…˜</span>
                    <div class="info-options">
                        {% if game_session.option1 and game_session.option2 %}
                                                         <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                         {% elif game_session.option1 %}
                             <span class="option-badge percival">ğŸ›¡ï¸ í¼ì‹œë²Œ</span>
                         {% elif game_session.option2 %}
                             <span class="option-badge morgana">ğŸ¦¹â€â™€ï¸ ëª¨ë¥´ê°€ë‚˜</span>
                        {% else %}
                            <span class="option-badge none">ğŸ¯ ê¸°ë³¸ ê²Œì„</span>
                        {% endif %}
                    </div>
                </div>
                
                <div class="info-item">
                    <span class="info-label">í˜„ì¬ í”Œë ˆì´ì–´</span>
                    <span class="info-value player-name">{{ player_nickname }}</span>
                </div>
            </div>
        </div>

        <!-- ì—ëŸ¬ ë©”ì‹œì§€ ì¹´ë“œ (ì—ëŸ¬ê°€ ìˆì„ ë•Œë§Œ í‘œì‹œ) -->
        {% if error_message %}
        <div class="message-alert error">
            <div class="alert-icon">âš ï¸</div>
            <div class="alert-text">{{ error_message }}</div>
        </div>
        {% endif %}

        <!-- í”Œë ˆì´ì–´ ëª©ë¡ ì¹´ë“œ -->
        <div class="players-card">
            <div class="players-header">
                <div class="players-icon">ğŸ‘¥</div>
                <h3 class="players-title">ì°¸ì—¬ ì¤‘ì¸ í”Œë ˆì´ì–´</h3>
                <div class="players-count" id="players-count">0ëª…</div>
            </div>
            
            <div class="players-content">
                <div id="player-list" class="player-list">
                    <div class="loading-placeholder">
                        <div class="loading-spinner"></div>
                        <span>í”Œë ˆì´ì–´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì„¸ì…˜ ë§í¬ ê³µìœ  ì¹´ë“œ -->
        <div class="share-card">
            <div class="share-header">
                <div class="share-icon">ğŸ”—</div>
                <h3 class="share-title">ì¹œêµ¬ ì´ˆëŒ€í•˜ê¸°</h3>
            </div>
            
            <div class="share-content">
                <div class="link-input-group">
                    <input type="text" id="session-link" value="{{ session_link }}" readonly class="share-input">
                    <button onclick="copySessionLink()" class="copy-btn">
                        <span class="copy-btn-icon">ğŸ“‹</span>
                        <span class="copy-btn-text">ë³µì‚¬</span>
                    </button>
                </div>
                <div id="copy-message" class="copy-message"></div>
            </div>
        </div>

        <!-- ê²Œì„ ì˜µì…˜ ì„¤ì • ì¹´ë“œ (í˜¸ìŠ¤íŠ¸ë§Œ ë³´ì„) -->
        {% if player_nickname == game_session.host_nickname %}
        <div class="game-options-card" style="background: rgba(255, 255, 255, 0.95); border-radius: 16px; padding: 1.5rem; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); margin-bottom: 1.5rem;">
            <div class="options-header" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(0, 0, 0, 0.1);">
                <div class="options-icon" style="font-size: 2rem; margin-right: 0.75rem; color: #667eea;">âš™ï¸</div>
                <h3 class="options-title" style="font-size: 1.3rem; font-weight: 600; margin: 0; color: #333; flex: 1;">ê²Œì„ ì˜µì…˜ ì„¤ì •</h3>
                <div class="options-note" style="font-size: 0.9rem; color: #667eea; background: linear-gradient(135deg, rgba(102, 126, 234, 0.15) 0%, rgba(118, 75, 162, 0.15) 100%); padding: 0.5rem 1rem; border-radius: 25px; font-weight: 600; border: 1px solid rgba(102, 126, 234, 0.2);">í”Œë ˆì´ì–´ ìˆ˜: <span id="current-player-count">{{ players_in_session|length }}</span>ëª…</div>
            </div>
            
            <div class="options-content" style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- í¼ì‹œë²Œ ì˜µì…˜ -->
                <div class="option-section" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 249, 250, 0.8) 100%); border-radius: 12px; padding: 1.3rem; border: 1px solid rgba(0, 0, 0, 0.05); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <h4 class="option-section-title" style="font-size: 1.1rem; font-weight: 600; margin: 0 0 1rem 0; color: #333; display: flex; align-items: center; gap: 0.75rem;">ğŸ•Šï¸ í™œì„± ì„ ì¸ ì„ íƒ</h4>
                    <div class="option-item" style="display: flex; align-items: stretch; gap: 0;">
                        <input type="checkbox" id="enable_percival" class="option-checkbox" style="display: none;">
                        <label for="enable_percival" class="option-label-compact" style="display: flex; align-items: center; gap: 1rem; cursor: pointer; width: 100%; padding: 1rem; border-radius: 12px; border: 2px solid rgba(102, 126, 234, 0.3); background: rgba(255, 255, 255, 0.8); transition: all 0.3s ease;">
                            <div class="option-icon-small" style="font-size: 1.8rem; filter: grayscale(60%); transition: all 0.3s ease;">ğŸ›¡ï¸</div>
                            <div class="option-text" style="display: flex; flex-direction: column; gap: 0.3rem; flex: 1;">
                                <span class="option-name" style="font-size: 1.05rem; font-weight: 600; color: #333; transition: color 0.3s ease;">í¼ì‹œë²Œ ì¶”ê°€</span>
                                <span class="option-desc" style="font-size: 0.9rem; color: #666; line-height: 1.4; transition: color 0.3s ease;">ë©€ë¦°ì„ ì§€í‚¤ëŠ” ì¶©ì§í•œ ìˆ˜í˜¸ì</span>
                            </div>
                            <div class="toggle-switch" style="width: 50px; height: 28px; background: #ddd; border-radius: 14px; position: relative; transition: all 0.3s ease;">
                                <div class="toggle-slider" style="position: absolute; width: 24px; height: 24px; background: white; border-radius: 50%; top: 2px; left: 2px; transition: all 0.3s ease; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);"></div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- í™œì„± ì•…ì¸ ì„ íƒ -->
                <div class="option-section" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(248, 249, 250, 0.8) 100%); border-radius: 12px; padding: 1.3rem; border: 1px solid rgba(0, 0, 0, 0.05); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);">
                    <h4 class="option-section-title" style="font-size: 1.1rem; font-weight: 600; margin: 0 0 1rem 0; color: #333; display: flex; align-items: center; gap: 0.75rem;">ğŸ˜ˆ í™œì„± ì•…ì¸ ì„ íƒ</h4>
                    <div class="role-selection-compact" style="display: flex; flex-direction: column; gap: 1rem; margin-bottom: 1.2rem;">
                        <!-- ë¹„í™œì„± ì˜ì—­ -->
                        <div class="role-list-compact" id="inactive-cards" style="background: linear-gradient(135deg, rgba(150, 150, 150, 0.1) 0%, rgba(200, 200, 200, 0.1) 100%); border-radius: 16px; padding: 1.2rem; border: 2px dashed rgba(150, 150, 150, 0.4); min-height: 120px;">
                            <div class="role-list-title" style="font-size: 0.95rem; font-weight: 700; color: #666; margin-bottom: 0.8rem; text-align: center; text-transform: uppercase; letter-spacing: 1px;">ë¹„í™œì„± ì•…ì¸</div>
                            <div class="role-cards-container" style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 0.8rem; min-height: 120px; place-items: center; max-width: 280px; margin: 0 auto;">
                                <div class="role-card-small inactive-role" data-role-id="morgana" style="background: linear-gradient(135deg, #999 0%, #777 100%); color: white; padding: 0.6rem 1rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600; text-align: center; box-shadow: 0 2px 8px rgba(150, 150, 150, 0.3); min-width: 90px; transition: all 0.3s ease;">ëª¨ë¥´ê°€ë‚˜</div>
                                <div class="role-card-small inactive-role" data-role-id="oberon" style="background: linear-gradient(135deg, #999 0%, #777 100%); color: white; padding: 0.6rem 1rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600; text-align: center; box-shadow: 0 2px 8px rgba(150, 150, 150, 0.3); min-width: 90px; transition: all 0.3s ease;">ì˜¤ë² ë¡ </div>
                                <div class="role-card-small inactive-role" data-role-id="mordred" style="background: linear-gradient(135deg, #999 0%, #777 100%); color: white; padding: 0.6rem 1rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600; text-align: center; box-shadow: 0 2px 8px rgba(150, 150, 150, 0.3); min-width: 90px; transition: all 0.3s ease;">ëª¨ë“œë ˆë“œ</div>
                            </div>
                        </div>

                        <!-- ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
                        <div class="role-controls" style="display: flex; justify-content: center; gap: 1rem; align-items: center;">
                            <button type="button" id="to-active" class="role-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 50%; width: 45px; height: 45px; color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">â–¼</button>
                            <button type="button" id="to-inactive" class="role-btn" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; border-radius: 50%; width: 45px; height: 45px; color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); transition: all 0.3s ease;">â–²</button>
                        </div>

                        <!-- í™œì„± ì˜ì—­ -->
                        <div class="role-list-compact" id="active-cards" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 16px; padding: 1.2rem; border: 2px dashed rgba(102, 126, 234, 0.4); min-height: 120px;">
                            <div class="role-list-title" style="font-size: 0.95rem; font-weight: 700; color: #667eea; margin-bottom: 0.8rem; text-align: center; text-transform: uppercase; letter-spacing: 1px;">í™œì„± ì•…ì¸</div>
                            
                            <!-- ì¼ë°˜ ì¹´ë“œ ì˜ì—­ (2x2 ê·¸ë¦¬ë“œ) -->
                            <div class="role-cards-container normal-cards" style="display: grid; grid-template-columns: 1fr 1fr; grid-gap: 0.8rem; min-height: 80px; place-items: center; max-width: 280px; margin: 0 auto 1rem auto;">
                                <div class="role-card-small active-role" data-role-id="assassin" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.6rem 1rem; border-radius: 25px; cursor: pointer; font-size: 0.9rem; font-weight: 600; text-align: center; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); min-width: 90px; transition: all 0.3s ease;">ì•”ì‚´ì</div>
                            </div>
                            
                            <!-- ê²¸ì§ ì¹´ë“œ ì˜ì—­ (ìë™ ì¤‘ì•™ ë°°ì¹˜) -->
                            <div class="combined-cards-container" style="display: flex; flex-wrap: wrap; gap: 0.8rem; justify-content: center; align-items: center; min-height: 40px; max-width: 100%;">
                            </div>
                        </div>
                    </div>

                    <div class="combine-controls-compact" style="display: flex; gap: 1rem; justify-content: center;">
                        <button type="button" id="combine" class="combine-btn" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.9) 100%); border: 2px solid #667eea; border-radius: 30px; padding: 0.7rem 1.5rem; color: #667eea; font-size: 0.95rem; font-weight: 600; cursor: pointer; min-width: 90px;">ê²¸ì§</button>
                        <button type="button" id="split" class="combine-btn" style="background: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(248, 249, 250, 0.9) 100%); border: 2px solid #667eea; border-radius: 30px; padding: 0.7rem 1.5rem; color: #667eea; font-size: 0.95rem; font-weight: 600; cursor: pointer; min-width: 90px;">ë¶„ë¦¬</button>
                    </div>
                </div>

                <!-- ê²½ê³  ë©”ì‹œì§€ -->
                <div id="validation-message" class="validation-message-compact" style="display: none; background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%); border: 2px solid #ffeaa7; color: #856404; padding: 1.2rem; border-radius: 16px; align-items: center; gap: 1rem; font-size: 0.95rem; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);">
                    <div class="message-icon" style="font-size: 1.5rem; flex-shrink: 0;">âš ï¸</div>
                    <div class="message-text" style="flex: 1; font-weight: 600; margin: 0; line-height: 1.4;"></div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- ê²Œì„ ì‹œì‘ ì¹´ë“œ (í˜¸ìŠ¤íŠ¸ë§Œ ë³´ì„) -->
        {% if player_nickname == game_session.host_nickname %}
        <div class="host-actions-card">
            <div class="host-header">
                <div class="host-icon">ğŸ‘‘</div>
                <h3 class="host-title">ê²Œì„ ì‹œì‘</h3>
                <div class="host-badge">í˜¸ìŠ¤íŠ¸</div>
            </div>
            
            <div class="host-content">
                <p class="start-description">ëª¨ë“  í”Œë ˆì´ì–´ê°€ ì¤€ë¹„ë˜ë©´ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!</p>
                <form method="post" action="{% url 'start_game' game_session.session_id %}" id="start-game-form">
                    {% csrf_token %}
                    <input type="hidden" name="nickname" value="{{ player_nickname }}">
                    <input type="hidden" name="pin" value="{{ player_pin }}">
                    <input type="hidden" name="active_roles" id="active-roles-data">
                    <input type="hidden" name="enable_percival" id="percival-data">
                    <button type="submit" class="start-game-btn" id="start-game-btn">
                        <span class="btn-icon">ğŸš€</span>
                        <span class="btn-text">ê²Œì„ ì‹œì‘</span>
                    </button>
                </form>
            </div>
        </div>
        {% endif %}

        <!-- ëŒ€ê¸° ì¤‘ ë©”ì‹œì§€ (í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹Œ ê²½ìš°) -->
        {% if player_nickname != game_session.host_nickname %}
        <div class="waiting-card">
            <div class="waiting-content">
                <div class="waiting-icon">â³</div>
                <h3 class="waiting-title">ê²Œì„ ì‹œì‘ì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</h3>
                <p class="waiting-description">í˜¸ìŠ¤íŠ¸ê°€ ê²Œì„ì„ ì‹œì‘í•  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_body %}
    <!-- ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ -->
    <meta name="csrf-token" content="{{ csrf_token }}">
    {{ game_session.enable_dummy|json_script:"enable-dummy-data" }}
    <script>
    // Django ë³€ìˆ˜ë¥¼ JavaScriptë¡œ ì „ë‹¬
    const enableDummyData = JSON.parse(document.getElementById('enable-dummy-data').textContent);
    window.enableDummy = enableDummyData;
    
    let lastHash = null;
    const playerNickname = "{{ player_nickname }}";
    const playerPin = "{{ player_pin }}";
    const csrfToken = document.querySelector('meta[name="csrf-token"]').content;
    
    function updatePlayerList() {
        const url = new URL("{% url 'get_state' game_session.session_id %}", window.location.origin);
        if (lastHash) {
            url.searchParams.append('hash', lastHash)
        };

        fetch(url)
            .then(response => {
                if (response.status === 204) { 
                    return; // ë³€ê²½ ì—†ìŒ, ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                }
                return response.json();
            })
            .then(data => {
                if (!data || !data.players) {
                    return;
                }

                if (data.is_active === false) {
                    window.location.href = "{% url 'ended' game_session.session_id %}";
                    return;
                }

                if (data.is_started === true) {
                    window.location.href = "{% url 'role' game_session.session_id %}?nickname=" + playerNickname + "&pin=" + playerPin;
                    return;
                }
                
                const playerListContainer = document.getElementById("player-list");
                const playersCount = document.getElementById("players-count");
                
                // í”Œë ˆì´ì–´ ìˆ˜ ì—…ë°ì´íŠ¸
                playersCount.textContent = data.players.length + 'ëª…';
                
                // í”Œë ˆì´ì–´ ëª©ë¡ ì´ˆê¸°í™”
                playerListContainer.innerHTML = '';

                data.players.forEach(function(nickname) {
                    const playerItem = document.createElement("div");
                    playerItem.className = "player-item";
                    
                    const isHost = nickname === data.host_nickname;
                    const canKick = playerNickname === data.host_nickname && nickname !== playerNickname;
                    
                    let kickButton = '';
                    if (canKick) {
                        kickButton = `
                            <form method="post" action="{% url 'kick_player' game_session.session_id %}" class="kick-form">
                                <input type="hidden" name="csrfmiddlewaretoken" value="${csrfToken}">
                                <input type="hidden" name="target_nickname" value="${nickname}">
                                <input type="hidden" name="nickname" value="${playerNickname}">
                                <input type="hidden" name="pin" value="${playerPin}">
                                <button type="submit" class="kick-btn" title="í”Œë ˆì´ì–´ ì¶”ë°©">
                                    <span class="kick-icon">âŒ</span>
                                </button>
                            </form>
                        `;
                    }
                    
                    const hostBadge = isHost ? ' ğŸ‘‘' : '';
                    
                    playerItem.innerHTML = `
                        <div class="player-info">
                            <div class="player-avatar">ğŸ‘¤</div>
                            <div class="player-details">
                                <span class="player-nickname">${nickname}${hostBadge}</span>
                            </div>
                        </div>
                        ${kickButton}
                    `;
                    
                    playerListContainer.appendChild(playerItem);
                });
                
                lastHash = data.hash;
                
                // í”Œë ˆì´ì–´ ìˆ˜ ì—…ë°ì´íŠ¸ (ì˜µì…˜ ì¹´ë“œìš©)
                const playerCountSpan = document.getElementById("current-player-count");
                if (playerCountSpan) {
                    const currentCount = data.players.length;
                    if (window.enableDummy && currentCount < 5) {
                        playerCountSpan.textContent = `${currentCount} (ë”ë¯¸ í¬í•¨ 5)`;
                    } else {
                        playerCountSpan.textContent = currentCount;
                    }
                }
            })
            .catch(err => console.error("í”Œë ˆì´ì–´ ëª©ë¡ ê°±ì‹  ì‹¤íŒ¨:", err));
    }

    // ì´ˆê¸° í”Œë ˆì´ì–´ ìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
    const initialPlayerCountSpan = document.getElementById("current-player-count");
    if (initialPlayerCountSpan && window.enableDummy) {
        const initialCount = parseInt(initialPlayerCountSpan.textContent);
        if (initialCount < 5) {
            initialPlayerCountSpan.textContent = `${initialCount} (ë”ë¯¸ í¬í•¨ 5)`;
        }
    }

    setInterval(updatePlayerList, 1000); // ms
    </script>

    <!-- ê²Œì„ ì˜µì…˜ ì„¤ì • ë¡œì§ -->
    <script>
    document.addEventListener("DOMContentLoaded", () => {
        // í˜¸ìŠ¤íŠ¸ê°€ ì•„ë‹ˆë©´ ì˜µì…˜ ë¡œì§ ì‹¤í–‰í•˜ì§€ ì•ŠìŒ
        if ("{{ player_nickname }}" !== "{{ game_session.host_nickname }}") {
            return;
        }

        // ê¸ˆì§€ëœ ì¡°í•© ì •ë³´
        const forbiddenCombinations = [
            ['mordred', 'oberon'],
            ['oberon', 'mordred'],
            ['morgana', 'oberon'],
            ['oberon', 'morgana']
        ];
        
        function showValidationMessage(message) {
            const messageDiv = document.getElementById("validation-message");
            const messageText = messageDiv.querySelector(".message-text");
            messageText.textContent = message;
            messageDiv.style.display = "flex";
            messageDiv.style.alignItems = "center";
            messageDiv.style.gap = "10px";
        }
        
        function hideValidationMessage() {
            const messageDiv = document.getElementById("validation-message");
            if (messageDiv) {
                messageDiv.style.display = "none";
            }
        }
        
        // í”Œë ˆì´ì–´ ìˆ˜ì— ë”°ë¥¸ ì•…ì¸ ìˆ˜ ê³„ì‚° í•¨ìˆ˜
        function getMaxEvilRoles(playerCount) {
            if (playerCount < 5 || playerCount > 10) {
                return 0;
            }
            if (playerCount <= 6) {
                return 2;
            } else if (playerCount <= 9) {
                return 3;
            } else {
                return 4;
            }
        }

        function validateConfiguration() {
            const normalCards = document.querySelectorAll("#active-cards .normal-cards .role-card-small");
            const combinedCards = document.querySelectorAll("#active-cards .combined-cards-container .role-card-small");
            const activeCards = [...normalCards, ...combinedCards];
            const roleGroups = [];
            let hasAssassin = false;

            // ì—­í•  ê·¸ë£¹ êµ¬ì„± ë° ì•”ì‚´ì ì²´í¬
            activeCards.forEach(card => {
                const rawId = card.dataset.roleId;
                
                if (card.dataset.combined === "true") {
                    const components = rawId.split('_');
                    roleGroups.push(components);
                    if (components.includes('assassin')) hasAssassin = true;
                } else {
                    roleGroups.push([rawId]);
                    if (rawId === 'assassin') hasAssassin = true;
                }
            });

            // í˜„ì¬ í”Œë ˆì´ì–´ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
            const currentPlayerCountSpan = document.getElementById("current-player-count");
            const currentPlayerCount = currentPlayerCountSpan ? parseInt(currentPlayerCountSpan.textContent) : 0;
            
            // ë”ë¯¸ í”Œë ˆì´ì–´ í¬í•¨í•œ ì´ í”Œë ˆì´ì–´ ìˆ˜ ê³„ì‚°
            let totalPlayerCount = currentPlayerCount;
            if (window.enableDummy && currentPlayerCount < 5) {
                totalPlayerCount = 5; // ë”ë¯¸ í”Œë ˆì´ì–´ë¡œ 5ëª…ê¹Œì§€ ì±„ì›€
            }
            
            const maxEvilRoles = getMaxEvilRoles(totalPlayerCount);
            const activeEvilCount = roleGroups.length; // ê²¸ì§ì€ 1ê°œë¡œ ê³„ì‚°ë¨

            // 1. í”Œë ˆì´ì–´ ìˆ˜ ì²´í¬ (ë”ë¯¸ í”Œë ˆì´ì–´ í™œì„±í™” ì‹œ ê±´ë„ˆë›°ê¸°)
            if (!window.enableDummy && currentPlayerCount < 5) {
                showValidationMessage("ğŸ‘¥ ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 5ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤!");
                return false;
            }

                         // 2. ì•…ì¸ ìˆ˜ ì²´í¬
             if (activeEvilCount > maxEvilRoles) {
                 const playerCountText = window.enableDummy && currentPlayerCount < 5 
                     ? `${totalPlayerCount}ëª… (ë”ë¯¸ í¬í•¨)` 
                     : `${currentPlayerCount}ëª…`;
                 showValidationMessage(`âš–ï¸ ${playerCountText}ì¼ ë•Œ ì•…ì¸ì€ ìµœëŒ€ ${maxEvilRoles}ëª…ì´ì–´ì•¼ í•©ë‹ˆë‹¤! í˜„ì¬ í™œì„± ì•…ì¸: ${activeEvilCount}ëª… (ê²¸ì§ì€ 1ëª…ìœ¼ë¡œ ê³„ì‚°)`);
                 return false;
             }

            // 3. ì•”ì‚´ì í•„ìˆ˜ ì²´í¬
            if (!hasAssassin) {
                showValidationMessage("âš”ï¸ ì•”ì‚´ìëŠ” í•„ìˆ˜ ì—­í• ì…ë‹ˆë‹¤! í™œì„± ì•…ì¸ì— í¬í•¨ì‹œì¼œì£¼ì„¸ìš”.");
                return false;
            }

            // 4. 3ê°œ ì´ìƒ ê²¸ì§ ì²´í¬
            for (const group of roleGroups) {
                if (group.length >= 3) {
                    showValidationMessage("ğŸš« 3ê°œ ì´ìƒì˜ ì—­í• ì€ ê²¸ì§í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!");
                    return false;
                }
            }

            // 5. ê¸ˆì§€ëœ ì¡°í•© ì²´í¬
            for (const group of roleGroups) {
                if (group.length === 2) {
                    const [role1, role2] = group;
                    for (const forbidden of forbiddenCombinations) {
                        if ((forbidden[0] === role1 && forbidden[1] === role2) ||
                            (forbidden[0] === role2 && forbidden[1] === role1)) {
                            showValidationMessage(`ğŸš« ${role1}ê³¼(ì™€) ${role2}ëŠ” ê²¸ì§í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                            return false;
                        }
                    }
                }
            }

            hideValidationMessage();
            return true;
        }

        function toggleSelection(card) {
            card.classList.toggle("selected");
            
            // ì„ íƒ ì‹œê° íš¨ê³¼ ì—…ë°ì´íŠ¸
            if (card.classList.contains("selected")) {
                card.style.background = "linear-gradient(135deg, #ff6b6b 0%, #ff8e53 100%)";
                card.style.transform = "scale(1.05)";
                card.style.boxShadow = "0 6px 20px rgba(255, 107, 107, 0.5)";
                card.style.border = "2px solid #ff6b6b";
            } else {
                // ì›ë˜ ìŠ¤íƒ€ì¼ë¡œ ë³µì› (í™œì„±/ë¹„í™œì„±ì— ë”°ë¼)
                if (card.closest("#active-cards")) {
                    if (card.dataset.combined === "true") {
                        // ê²¸ì§ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #764ba2 0%, #667eea 100%)";
                        card.style.boxShadow = "0 4px 12px rgba(118, 75, 162, 0.4)";
                        card.style.overflow = "visible";
                        card.style.paddingTop = "0.8rem";
                    } else {
                        // ì¼ë°˜ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                        card.style.boxShadow = "0 4px 12px rgba(102, 126, 234, 0.3)";
                    }
                } else {
                    if (card.dataset.combined === "true") {
                        // ê²¸ì§ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #666 0%, #444 100%)";
                        card.style.boxShadow = "0 2px 8px rgba(100, 100, 100, 0.4)";
                        card.style.overflow = "visible";
                        card.style.paddingTop = "0.8rem";
                    } else {
                        // ì¼ë°˜ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #999 0%, #777 100%)";
                        card.style.boxShadow = "0 2px 8px rgba(150, 150, 150, 0.3)";
                    }
                }
                card.style.transform = "scale(1)";
                card.style.border = "2px solid transparent";
            }
            
            setTimeout(validateConfiguration, 100);
        }

        function moveSelected(sourceList, targetList) {
            const selected = sourceList.querySelectorAll(".role-card-small.selected");
            selected.forEach(card => {
                card.classList.remove("selected");
                // ì´ë™ ì‹œ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                if (targetList.id === "active-cards") {
                    if (card.dataset.combined === "true") {
                        // ê²¸ì§ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #764ba2 0%, #667eea 100%)";
                        card.style.boxShadow = "0 4px 12px rgba(118, 75, 162, 0.4)";
                        card.style.overflow = "visible";
                        card.style.paddingTop = "0.8rem";
                    } else {
                        // ì¼ë°˜ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                        card.style.boxShadow = "0 4px 12px rgba(102, 126, 234, 0.3)";
                    }
                    card.className = "role-card-small active-role";
                } else {
                    if (card.dataset.combined === "true") {
                        // ê²¸ì§ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #666 0%, #444 100%)";
                        card.style.boxShadow = "0 2px 8px rgba(100, 100, 100, 0.4)";
                        card.style.overflow = "visible";
                        card.style.paddingTop = "0.8rem";
                    } else {
                        // ì¼ë°˜ ì¹´ë“œ ìŠ¤íƒ€ì¼
                        card.style.background = "linear-gradient(135deg, #999 0%, #777 100%)";
                        card.style.boxShadow = "0 2px 8px rgba(150, 150, 150, 0.3)";
                    }
                    card.className = "role-card-small inactive-role";
                }
                card.style.transform = "scale(1)";
                card.style.border = "2px solid transparent";
                
                // ì¹´ë“œ íƒ€ì…ì— ë”°ë¼ ì ì ˆí•œ ì»¨í…Œì´ë„ˆì— ë°°ì¹˜
                if (targetList.id === "active-cards") {
                    if (card.dataset.combined === "true") {
                        targetList.querySelector('.combined-cards-container').appendChild(card);
                    } else {
                        targetList.querySelector('.normal-cards').appendChild(card);
                    }
                } else {
                    targetList.querySelector('.role-cards-container').appendChild(card);
                }
            });
            validateConfiguration();
        }

        function combineSelected(list) {
            const selected = list.querySelectorAll(".role-card-small.selected");
            if (selected.length !== 2) {
                showValidationMessage("ğŸ”— ê²¸ì§í•˜ë ¤ë©´ ì •í™•íˆ 2ê°œì˜ ì—­í• ì„ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            const names = Array.from(selected).map(c => c.innerText);
            const ids = Array.from(selected).map(c => c.dataset.roleId);
            
            // ê²¸ì§ ì „ ë¯¸ë¦¬ ê²€ì¦
            for (const forbidden of forbiddenCombinations) {
                if ((forbidden[0] === ids[0] && forbidden[1] === ids[1]) ||
                    (forbidden[0] === ids[1] && forbidden[1] === ids[0])) {
                    showValidationMessage(`ğŸš« ${names[0]}ê³¼(ì™€) ${names[1]}ëŠ” ê²¸ì§í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`);
                    return;
                }
            }

            const combinedName = names.join(" + ");
            const combinedID = ids.join("_");

            const newCard = document.createElement("div");
            newCard.className = "role-card-small";
            newCard.dataset.roleId = combinedID;
            newCard.dataset.combined = "true";

            // ê²¸ì§ ì¹´ë“œ ë‚´ìš© êµ¬ì„± (ë²ˆê°œ ì•„ì´ì½˜ í¬í•¨)
            newCard.innerHTML = `
                <span class="lightning-icon" style="position: absolute; top: -2px; right: -2px; font-size: 14px; z-index: 10;">âš¡</span>
                <span class="card-text">${combinedName}</span>
            `;

            // ê²¸ì§ ì¹´ë“œ ì „ìš© ìŠ¤íƒ€ì¼ ì ìš©
            if (list.id === "active-cards") {
                newCard.style.cssText = `
                    background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
                    color: white;
                    padding: 0.6rem 1rem;
                    border-radius: 25px;
                    cursor: pointer;
                    font-size: 0.85rem;
                    font-weight: 600;
                    text-align: center;
                    box-shadow: 0 4px 12px rgba(118, 75, 162, 0.4);
                    min-width: 120px;
                    transition: all 0.3s ease;
                    position: relative;
                    border: 2px solid rgba(255, 255, 255, 0.2);
                    overflow: visible;
                    padding-top: 0.8rem;
                `;
            } else {
                newCard.style.cssText = `
                    background: linear-gradient(135deg, #666 0%, #444 100%);
                    color: white;
                    padding: 0.6rem 1rem;
                    border-radius: 25px;
                    cursor: pointer;
                    font-size: 0.85rem;
                    font-weight: 600;
                    text-align: center;
                    box-shadow: 0 2px 8px rgba(100, 100, 100, 0.4);
                    min-width: 120px;
                    transition: all 0.3s ease;
                    position: relative;
                    border: 2px solid rgba(255, 255, 255, 0.1);
                    overflow: visible;
                    padding-top: 0.8rem;
                `;
            }

            newCard.addEventListener("click", () => toggleSelection(newCard));

            selected.forEach(c => c.remove());
            
            // ê²¸ì§ ì¹´ë“œëŠ” combined-cards-containerì— ì¶”ê°€
            if (list.id === "active-cards") {
                list.querySelector('.combined-cards-container').appendChild(newCard);
            } else {
                list.querySelector('.role-cards-container').appendChild(newCard);
            }
            
            validateConfiguration();
        }

        function splitSelected(list) {
            const selected = list.querySelectorAll(".role-card-small.selected");
            selected.forEach(card => {
                if (!card.dataset.combined) return;

                // ë²ˆê°œ ì•„ì´ì½˜ ì œì™¸í•˜ê³  í…ìŠ¤íŠ¸ë§Œ ê°€ì ¸ì˜¤ê¸°
                const cardText = card.querySelector('.card-text');
                const parts = cardText ? cardText.textContent.split(" + ") : card.innerText.split(" + ");
                const ids = card.dataset.roleId.split("_");
                
                parts.forEach((name, index) => {
                    const partCard = document.createElement("div");
                    partCard.className = "role-card-small";
                    partCard.textContent = name;
                    partCard.dataset.roleId = ids[index] || name.replace(/\s+/g, '_');
                    
                    // ë¶„ë¦¬ëœ ì¹´ë“œ ìŠ¤íƒ€ì¼ ì ìš© (ì¼ë°˜ ì¹´ë“œ ìŠ¤íƒ€ì¼, ë²ˆê°œ ì•„ì´ì½˜ ì—†ìŒ)
                    if (list.id === "active-cards") {
                        partCard.style.cssText = `
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            padding: 0.6rem 1rem;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 0.9rem;
                            font-weight: 600;
                            text-align: center;
                            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
                            min-width: 90px;
                            transition: all 0.3s ease;
                            position: relative;
                            border: 2px solid transparent;
                        `;
                        partCard.className += " active-role";
                    } else {
                        partCard.style.cssText = `
                            background: linear-gradient(135deg, #999 0%, #777 100%);
                            color: white;
                            padding: 0.6rem 1rem;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 0.9rem;
                            font-weight: 600;
                            text-align: center;
                            box-shadow: 0 2px 8px rgba(150, 150, 150, 0.3);
                            min-width: 90px;
                            transition: all 0.3s ease;
                            position: relative;
                            border: 2px solid transparent;
                        `;
                        partCard.className += " inactive-role";
                    }
                    
                    partCard.addEventListener("click", () => toggleSelection(partCard));
                    
                    // ë¶„ë¦¬ëœ ì¹´ë“œëŠ” ì¼ë°˜ ì¹´ë“œ ì˜ì—­ì— ì¶”ê°€
                    if (list.id === "active-cards") {
                        list.querySelector('.normal-cards').appendChild(partCard);
                    } else {
                        list.querySelector('.role-cards-container').appendChild(partCard);
                    }
                });
                card.remove();
            });
            
            validateConfiguration();
        }

        // ì—­í•  ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
        document.querySelectorAll(".role-card-small").forEach(card => {
            card.addEventListener("click", () => toggleSelection(card));
        });

        // ì´ë™ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("to-active").addEventListener("click", () => {
            moveSelected(document.getElementById("inactive-cards"), document.getElementById("active-cards"));
        });

        document.getElementById("to-inactive").addEventListener("click", () => {
            moveSelected(document.getElementById("active-cards"), document.getElementById("inactive-cards"));
        });

        // ê²¸ì§ ë²„íŠ¼ ì´ë²¤íŠ¸
        document.getElementById("combine").addEventListener("click", () => {
            combineSelected(document.getElementById("active-cards"));
        });

        document.getElementById("split").addEventListener("click", () => {
            splitSelected(document.getElementById("active-cards"));
        });

        // í¼ ì œì¶œ ì‹œ ë°ì´í„° ì„¤ì •
        document.getElementById("start-game-form").addEventListener("submit", (e) => {
            // ê²Œì„ ì‹œì‘ ì „ ìµœì¢… ê²€ì¦
            if (!validateConfiguration()) {
                e.preventDefault();
                return false;
            }

            // í™œì„± ì—­í•  ë°ì´í„° ì„¤ì •
            const normalCards = document.querySelectorAll("#active-cards .normal-cards .role-card-small");
            const combinedCards = document.querySelectorAll("#active-cards .combined-cards-container .role-card-small");
            const activeCards = [...normalCards, ...combinedCards];
            const roleGroups = [];

            activeCards.forEach(card => {
                const rawId = card.dataset.roleId;

                if (card.dataset.combined === "true") {
                    const components = rawId.split('_');
                    roleGroups.push(components);
                } else {
                    roleGroups.push([rawId]);
                }
            });

            // ìµœì¢… ê²€ì¦: í”Œë ˆì´ì–´ ìˆ˜ì™€ ì•…ì¸ ìˆ˜ ì¬í™•ì¸
            const currentPlayerCountSpan = document.getElementById("current-player-count");
            const currentPlayerCount = currentPlayerCountSpan ? parseInt(currentPlayerCountSpan.textContent) : 0;
            
            // ë”ë¯¸ í”Œë ˆì´ì–´ í¬í•¨í•œ ì´ í”Œë ˆì´ì–´ ìˆ˜ ê³„ì‚°
            let totalPlayerCount = currentPlayerCount;
            if (window.enableDummy && currentPlayerCount < 5) {
                totalPlayerCount = 5; // ë”ë¯¸ í”Œë ˆì´ì–´ë¡œ 5ëª…ê¹Œì§€ ì±„ì›€
            }
            
            const maxEvilRoles = getMaxEvilRoles(totalPlayerCount);
            const activeEvilCount = roleGroups.length;

            if (!window.enableDummy && currentPlayerCount < 5) {
                showValidationMessage("ğŸ‘¥ ê²Œì„ì„ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 5ëª…ì˜ í”Œë ˆì´ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤!");
                e.preventDefault();
                return false;
            }

            if (activeEvilCount > maxEvilRoles) {
                const playerCountText = window.enableDummy && currentPlayerCount < 5 
                    ? `${totalPlayerCount}ëª… (ë”ë¯¸ í¬í•¨)` 
                    : `${currentPlayerCount}ëª…`;
                showValidationMessage(`âš–ï¸ ${playerCountText}ì¼ ë•Œ ì•…ì¸ì€ ìµœëŒ€ ${maxEvilRoles}ëª…ì´ì–´ì•¼ í•©ë‹ˆë‹¤! í˜„ì¬ í™œì„± ì•…ì¸: ${activeEvilCount}ëª… (ê²¸ì§ì€ 1ëª…ìœ¼ë¡œ ê³„ì‚°)`);
                e.preventDefault();
                return false;
            }

            document.getElementById("active-roles-data").value = JSON.stringify(roleGroups);

            // í¼ì‹œë²Œ ì˜µì…˜ ì„¤ì •
            const percivalChecked = document.getElementById("enable_percival").checked;
            document.getElementById("percival-data").value = percivalChecked ? "true" : "false";

            // ìµœì¢… í™•ì¸ ë©”ì‹œì§€ - êµ¬ì²´ì ì¸ ì—­í•  ë‚˜ì—´
            const playerInfoText = window.enableDummy && currentPlayerCount < 5 
                ? `í”Œë ˆì´ì–´: ${currentPlayerCount}ëª… + ë”ë¯¸ ${5 - currentPlayerCount}ëª… = ì´ ${totalPlayerCount}ëª…`
                : `í”Œë ˆì´ì–´: ${currentPlayerCount}ëª…`;
            
            // ì„ íƒëœ íŠ¹ìˆ˜ ì—­í• ë“¤ ìˆ˜ì§‘
            const evilRoles = [];
            const goodRoles = ["ë©€ë¦°"];
            
            roleGroups.forEach(group => {
                if (group.length === 1) {
                    // ë‹¨ì¼ ì—­í• 
                    const roleName = group[0] === 'assassin' ? 'ì•”ì‚´ì' : 
                                   group[0] === 'mordred' ? 'ëª¨ë“œë ˆë“œ' :
                                   group[0] === 'morgana' ? 'ëª¨ë¥´ê°€ë‚˜' :
                                   group[0] === 'oberon' ? 'ì˜¤ë² ë¡ ' : group[0];
                    evilRoles.push(roleName);
                } else {
                    // ê²¸ì§ ì—­í• 
                    const combinedNames = group.map(role => 
                        role === 'assassin' ? 'ì•”ì‚´ì' : 
                        role === 'mordred' ? 'ëª¨ë“œë ˆë“œ' :
                        role === 'morgana' ? 'ëª¨ë¥´ê°€ë‚˜' :
                        role === 'oberon' ? 'ì˜¤ë² ë¡ ' : role
                    );
                    evilRoles.push(combinedNames.join(' + '));
                }
            });
            
            if (percivalChecked) {
                goodRoles.push("í¼ì‹œë²Œ");
            }
            
            const evilText = evilRoles.length > 0 ? `íŠ¹ìˆ˜ ì•…ì¸: ${evilRoles.join(', ')}` : "íŠ¹ìˆ˜ ì•…ì¸: ì—†ìŒ";
            const goodText = `íŠ¹ìˆ˜ ì„ ì¸: ${goodRoles.join(', ')}`;
            
            if (!confirm(`ê²Œì„ì„ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\n${playerInfoText}\n${evilText}\n${goodText}`)) {
                e.preventDefault();
                return false;
            }
        });

        // í¼ì‹œë²Œ í† ê¸€ ì²˜ë¦¬
        const percivalCheckbox = document.getElementById("enable_percival");
        const percivalLabel = document.querySelector('label[for="enable_percival"]');
        const percivalIcon = percivalLabel.querySelector('.option-icon-small');
        const percivalToggle = percivalLabel.querySelector('.toggle-switch');
        const percivalSlider = percivalLabel.querySelector('.toggle-slider');
        const percivalName = percivalLabel.querySelector('.option-name');
        const percivalDesc = percivalLabel.querySelector('.option-desc');

        function updatePercivalToggle() {
            if (percivalCheckbox.checked) {
                // í™œì„±í™” ìƒíƒœ
                percivalLabel.style.background = "linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%)";
                percivalLabel.style.borderColor = "#667eea";
                percivalIcon.style.filter = "none";
                percivalIcon.style.transform = "scale(1.2)";
                percivalName.style.color = "#667eea";
                percivalDesc.style.color = "#555";
                percivalToggle.style.background = "rgba(102, 126, 234, 0.3)";
                percivalSlider.style.transform = "translateX(22px)";
            } else {
                // ë¹„í™œì„±í™” ìƒíƒœ
                percivalLabel.style.background = "rgba(255, 255, 255, 0.8)";
                percivalLabel.style.borderColor = "rgba(102, 126, 234, 0.3)";
                percivalIcon.style.filter = "grayscale(60%)";
                percivalIcon.style.transform = "scale(1)";
                percivalName.style.color = "#333";
                percivalDesc.style.color = "#666";
                percivalToggle.style.background = "#ddd";
                percivalSlider.style.transform = "translateX(0)";
            }
        }

        percivalCheckbox.addEventListener('change', updatePercivalToggle);
        
        // ì´ˆê¸° ìƒíƒœ ì„¤ì •
        updatePercivalToggle();

        // ì´ˆê¸° ê²€ì¦ ì‹¤í–‰
        validateConfiguration();
    });
    </script>

    <!-- ë§í¬ ë³µì‚¬ -->
    <script>
    function copySessionLink() {
        const input = document.getElementById("session-link");
        const copyMessage = document.getElementById("copy-message");
        const copyBtn = document.querySelector(".copy-btn");
        
        input.select();
        input.setSelectionRange(0, 99999); // ëª¨ë°”ì¼ ëŒ€ì‘

        try {
            const successful = document.execCommand('copy');
            if (successful) {
                copyMessage.textContent = "âœ… í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!";
                copyMessage.className = "copy-message success";
                copyBtn.innerHTML = '<span class="copy-btn-icon">âœ…</span><span class="copy-btn-text">ë³µì‚¬ë¨</span>';
            } else {
                copyMessage.textContent = "âŒ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
                copyMessage.className = "copy-message error";
            }
        } catch (err) {
            copyMessage.textContent = "âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” ë³µì‚¬ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            copyMessage.className = "copy-message error";
        }

        setTimeout(() => {
            copyMessage.textContent = "";
            copyMessage.className = "copy-message";
            copyBtn.innerHTML = '<span class="copy-btn-icon">ğŸ“‹</span><span class="copy-btn-text">ë³µì‚¬</span>';
        }, 2000);
    }
    </script>
{% endblock %}